<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="惠善一的博客主要包括对前端技术的分享, 为什么要写博客, ShanYi Hui的blog, 网络日志。"><meta name="baidu-site-verification" content="iXh8j30RO8"><meta name="keywords" content="惠善一, 博客, blog, huishanyi, HuiShanYi, ShanYiHui, ShanYi-Hui"><title>Redux与react-redux | 惠善一的博客</title><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.3"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.3"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Redux与react-redux</h1><a id="logo" href="/.">惠善一的博客</a><p class="description">SumBlog</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Redux与react-redux</h1><div class="post-meta"><a href="/2019/11/04/React/Redux与react-redux/#comments" class="comment-count"><i id="changyan_count_unit" data-xid="2019/11/04/React/Redux与react-redux/"></i>留言,<i id="changyan_parti_unit" data-xid="2019/11/04/React/Redux与react-redux/"></i>参与</a><p><span class="date">Nov 04, 2019</span><span><a href="/categories/前端/" class="category">前端</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>&emsp;&emsp;Redux 是 JavaScript 应用程序的可预测状态容器。其他背景、原理、接口我就不多说了，因为看<a href="https://redux.js.org/" target="_blank" title="Redux 官方文档">官方文档</a>就够了，至于英文不太 OK 的“爱国人士”可以看<a href="https://www.redux.org.cn/" target="_blank" title="Redux 汉化文档">汉化文档</a>。想要充分的使用一定要详读文档，理解它才可让它更高效（即优化）。<br>&emsp;&emsp;虽然总是见到 Redux 和 React 一起使用，并且都是字母 r 开头的单词，但是它们两个其实没有半毛钱的关系，真正与 React 有关的叫 <a href="https://react-redux.js.org/" target="_blank" title="react-redux 官方文档">react-redux</a> （Redux官方文档与汉化文档也都有提到）。</p>
<h1 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h1><blockquote>
<p>默认你对 Redux 有些了解了，本篇文章只会告诉你它是如何<strong>集中管理项目中的 state</strong>，项目中该如何使用（React 项目中使用 react-redux 更方便）。</p>
</blockquote>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>运行命令<code>npm install --save redux</code>。</p>
<p><img src="/images/redux_install.png" alt="安装 redux" title="安装 redux"></p>
<h2 id="创建状态管理文件"><a href="#创建状态管理文件" class="headerlink" title="创建状态管理文件"></a>创建状态管理文件</h2><p>目录结构如下（默认是以 <a href="https://huishanyi.club/2019/09/05/React/create-react-app/" target="_blank">create-react-app</a> 创建的项目）：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">项目根目录</span><br><span class="line">└── src</span><br><span class="line">    └── store（状态管理目录）</span><br><span class="line">        ├── index.js （创建 store，Redux 应用只有一个单一的 store， 需要拆分数据处理逻辑时，使用 reducer 组合）</span><br><span class="line">        ├── actionTypes.js（定义 action 类型）</span><br><span class="line">        ├── actionCreators.js（创建 action 对象，包括必须要的 action 类型与非必须的数据）</span><br><span class="line">        └── reducer.js（state 处理库，纯函数，接收旧的 state 和 action，返回新的 state）</span><br></pre></td></tr></table></figure>

<h3 id="js-文件源码及说明（toDoList-为例）"><a href="#js-文件源码及说明（toDoList-为例）" class="headerlink" title="js 文件源码及说明（toDoList 为例）"></a>js 文件源码及说明（toDoList 为例）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****** index.js ******/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;createStore&#125; <span class="keyword">from</span> <span class="string">'redux'</span> </span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// window.__REDUX_DEVTOOLS_EXTENSION__ &amp;&amp; window.__REDUX_DEVTOOLS_EXTENSION__() 是配置调试工具 Redux DevTools，可在浏览器开发工具 Redux 专栏进行应用调试</span></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer, <span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION__ &amp;&amp; <span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION__()) <span class="comment">// 创建 store</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>


<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****** reducer.js ******/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入常量，避免项目过大，“手抽筋”敲错导致功能异常且浏览器不报错（字符串敲错浏览器不报错，常量敲错浏览器会报错）</span></span><br><span class="line"><span class="keyword">import</span> &#123;CHANGE_INPUT_VALUE, ADD_LIST_ITEM, DELETE_LIST_ITEM, INIT_STATE&#125; <span class="keyword">from</span> <span class="string">'./actionTypes'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultState = &#123; <span class="comment">// state 初始化</span></span><br><span class="line">    inputValue: <span class="string">''</span>,</span><br><span class="line">    list: []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState, action) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 禁止修改 state，所以这里做一次深拷贝（喜欢新语法也可以试试 ES7 的对象展开运算符）</span></span><br><span class="line">    <span class="keyword">const</span> newState = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(state))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 匹配值为具体数值时请用 switch case 语句（发现很多人对 if else 爱的不能自拔啊）</span></span><br><span class="line">    <span class="keyword">switch</span>(action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> CHANGE_INPUT_VALUE: <span class="comment">// 根据不同事件类型，更新 state 中指定数据</span></span><br><span class="line">            newState.inputValue = action.value</span><br><span class="line">            <span class="keyword">return</span> newState</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> ADD_LIST_ITEM:</span><br><span class="line">            newState.list = [...newState.list, state.inputValue]</span><br><span class="line">            newState.inputValue = <span class="string">''</span></span><br><span class="line">            <span class="keyword">return</span> newState</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> DELETE_LIST_ITEM:</span><br><span class="line">            newState.list.splice(action.index, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> newState</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> INIT_STATE:</span><br><span class="line">            newState.list = action.list</span><br><span class="line">            <span class="keyword">return</span> newState</span><br><span class="line"></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> newState <span class="comment">// 此处 newState 即 state，为统一写为 newState</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****** actionTypes.js（也可以叫 constants.js） ******/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明并导出常量</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CHANGE_INPUT_VALUE = <span class="string">'change_input_value'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_LIST_ITEM = <span class="string">'add_list_item'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> DELETE_LIST_ITEM = <span class="string">'delete_list_item'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> INIT_STATE = <span class="string">'init_state'</span></span><br></pre></td></tr></table></figure>


<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****** actionCreators.js ******/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入常量，避免项目过大，“手抽筋”敲错导致功能异常且浏览器不报错（字符串敲错浏览器不报错，常量敲错浏览器会报错）</span></span><br><span class="line"><span class="keyword">import</span> &#123;CHANGE_INPUT_VALUE, ADD_LIST_ITEM, DELETE_LIST_ITEM, INIT_STATE&#125; <span class="keyword">from</span> <span class="string">'./actionTypes'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出可供组件使用的方法（组件中调用此方法创建 action 对象）</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getInputChangeAction = <span class="function">(<span class="params">value</span>) =&gt;</span> (&#123;</span><br><span class="line">    type: CHANGE_INPUT_VALUE,</span><br><span class="line">    value <span class="comment">// value: value，键名与键值相同时可简写，建议使用相同的键名与键值来精简代码</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getAddListItemAction = <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    type: ADD_LIST_ITEM</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getDeleteListItemAction = <span class="function">(<span class="params">index</span>) =&gt;</span> (&#123;</span><br><span class="line">    type: DELETE_LIST_ITEM,</span><br><span class="line">    index</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> initState = <span class="function">(<span class="params">list</span>) =&gt;</span> (&#123;</span><br><span class="line">    type: INIT_STATE,</span><br><span class="line">    list</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****** 逻辑组件 ******/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> TodoUI <span class="keyword">from</span> <span class="string">'./TodoUi'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入状态管理模块</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span></span><br><span class="line"><span class="keyword">import</span> &#123;getInputChangeAction, getAddListItemAction, getDeleteListItemAction, initState&#125; <span class="keyword">from</span> <span class="string">'./store/actionCreators'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props)</span><br><span class="line">        <span class="keyword">this</span>.state = store.getState()</span><br><span class="line">        store.subscribe(<span class="keyword">this</span>.storeChange)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;TodoUI </span><br><span class="line">                inputValue = &#123;<span class="keyword">this</span>.state.inputValue&#125;</span><br><span class="line">                list = &#123;<span class="keyword">this</span>.state.list&#125;</span><br><span class="line">                inputChange = &#123;<span class="keyword">this</span>.inputChange&#125;</span><br><span class="line">                addListItem = &#123;<span class="keyword">this</span>.addListItem&#125;</span><br><span class="line">                deleteListItem = &#123;<span class="keyword">this</span>.deleteListItem&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        axios.get(<span class="string">'/list.json'</span>) <span class="comment">// 可在项目根目录下的 public 文件中创建 list.json 进行数据模拟</span></span><br><span class="line">            .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(res)</span><br><span class="line">                <span class="keyword">const</span> action = initState(res.data)</span><br><span class="line">                store.dispatch(action)</span><br><span class="line">            &#125;)</span><br><span class="line">            .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(err)</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    inputChange = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> action = getInputChangeAction(e.target.value) <span class="comment">// 声明 action ，调用 actionCreators.js 中的方法创建 action 对象</span></span><br><span class="line">        store.dispatch(action)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    addListItem = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> action = getAddListItemAction()</span><br><span class="line">        store.dispatch(action)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    deleteListItem = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> action = getDeleteListItemAction(e.target.getAttribute(<span class="string">'index'</span>))</span><br><span class="line">        store.dispatch(action)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    storeChange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(store.getState)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Todo</span><br></pre></td></tr></table></figure>

<h3 id="toDoList-实例下载"><a href="#toDoList-实例下载" class="headerlink" title="toDoList 实例下载"></a>toDoList 实例下载</h3><p><a href="/files/todo.zip" download>todoList Redux实例下载</a></p>
<h1 id="react-redux"><a href="#react-redux" class="headerlink" title="react-redux"></a>react-redux</h1><blockquote>
<p>react-redux 是 Redux 的官方 React 绑定库，在 React 项目中若使用 Redux，建议配合 react-redux，它可以使你的 React 组件与 Redux store数据传递更方便快捷。</p>
</blockquote>
<h2 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h2><p>运行命令<code>npm install --save react-redux</code>（默认你已安装完成 redux）。</p>
<p><img src="/images/react-redux_install.png" alt="安装 redux" title="安装 redux"></p>
<h2 id="创建状态管理文件-1"><a href="#创建状态管理文件-1" class="headerlink" title="创建状态管理文件"></a>创建状态管理文件</h2><p>部分目录结构如下（默认是以 <a href="https://huishanyi.club/2019/09/05/React/create-react-app/" target="_blank">create-react-app</a> 创建的项目）：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">项目根目录</span><br><span class="line">└── src</span><br><span class="line">    ├── index.js （create-react-app 生成的 index.js）</span><br><span class="line">    ├── App.js （项目所有组件的插槽）</span><br><span class="line">    ├── store （状态管理目录）</span><br><span class="line">    │   ├── index.js （创建 store，Redux 应用只有一个单一的 store， 需要拆分数据处理逻辑时，使用 reducer 组合）</span><br><span class="line">    │   └── reducer.js （汇总所有子组件的 reducer，state 区块化）</span><br><span class="line">    └── common （公共组件目录）</span><br><span class="line">        └── header （公共头部组件）</span><br><span class="line">            ├── index.js （header UI 组件）</span><br><span class="line">            ├── style.js （创建带有样式的组件，须配合 styled-components 包使用）</span><br><span class="line">            └── store</span><br><span class="line">                ├── index.js （仅做 header 组件的 reducer 导出）</span><br><span class="line">                ├── constants.js （定义 action 类型）</span><br><span class="line">                ├── actionCreators.js （创建 action 对象，包括必须要的 action 类型与非必须的数据）</span><br><span class="line">                └── reducer.js（state 处理库，纯函数，接收旧的 state 和 action，返回新的 state）</span><br></pre></td></tr></table></figure>

<h3 id="js-文件示例及说明"><a href="#js-文件示例及说明" class="headerlink" title="js 文件示例及说明"></a>js 文件示例及说明</h3><h4 id="src-index-js"><a href="#src-index-js" class="headerlink" title="src/index.js"></a>src/index.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****** src/index.js ******/</span></span><br><span class="line"><span class="comment">// 页面所有可见内容来自于 App 组件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App'</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span>, document.getElementById('root')); // 挂载到页面</span></span><br></pre></td></tr></table></figure>


<h4 id="src-App-js"><a href="#src-App-js" class="headerlink" title="src/App.js"></a>src/App.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****** src/App.js ******/</span></span><br><span class="line"><span class="comment">// 页面所有可见内容的插槽（页面最大的容器组件）</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="comment">// 被 &lt;Provider&gt; 包裹的所有组件都可以访问 store</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span> </span><br><span class="line"><span class="comment">// React 应用路由，相关博文以阐述</span></span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter, Switch, Route &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span> <span class="comment">// 引入状态管理库</span></span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">'./common/header'</span> <span class="comment">// 引入 header 组件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'./pages/home'</span> <span class="comment">// 引入 Home 页面</span></span><br><span class="line"><span class="keyword">import</span> Detail <span class="keyword">from</span> <span class="string">'./pages/detail'</span> <span class="comment">// 引入 Detail 页面</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">        &lt;Header /&gt;</span><br><span class="line">        &lt;BrowserRouter&gt;</span><br><span class="line">          &lt;Switch&gt;</span><br><span class="line">            &lt;Route exact path=<span class="string">'/'</span> component=&#123;Home&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">            &lt;Route path=<span class="string">'/detail'</span> component=&#123;Detail&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">          &lt;<span class="regexp">/Switch&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>BrowserRouter&gt;</span><br><span class="line">      &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App; <span class="comment">// 导出供 src/index.js 使用</span></span><br></pre></td></tr></table></figure>


<h4 id="src-store-index"><a href="#src-store-index" class="headerlink" title="src/store/index"></a>src/store/index</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****** src/store/index ******/</span></span><br><span class="line"><span class="comment">// 创建状态管理库</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, compose, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">'redux-thunk'</span> <span class="comment">// 引入 redux-thunk 中间件进行异步 action，提高性能</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 composeEnhancers 进行对 Redux 的中间件拓展</span></span><br><span class="line"><span class="keyword">const</span> composeEnhancers = <span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;  </span><br><span class="line"><span class="comment">// 创建 store，使用中间件增强 Redux</span></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer, composeEnhancers( </span><br><span class="line">    applyMiddleware(thunk)</span><br><span class="line">))</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>


<h4 id="src-store-reducer-js"><a href="#src-store-reducer-js" class="headerlink" title="src/store/reducer.js"></a>src/store/reducer.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****** src/store/reducer.js ******/</span></span><br><span class="line"><span class="comment">// 汇总所有 Reducer，营造良好的 Redux 结构，方便数据管理</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 redux-immutable 对 Redux 项目 reducer 进行分类汇总管理</span></span><br><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux-immutable'</span> </span><br><span class="line"><span class="keyword">import</span> &#123; reducer  <span class="keyword">as</span> headerReducer &#125; <span class="keyword">from</span> <span class="string">'../common/header/store'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducer =  combineReducers(&#123;</span><br><span class="line">    header: headerReducer</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> reducer</span><br></pre></td></tr></table></figure>


<h4 id="header-index-js"><a href="#header-index-js" class="headerlink" title="header/index.js"></a>header/index.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****** src/common/header/index.js ******/</span></span><br><span class="line"><span class="comment">// header UI组件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="comment">// 使组件与 store 建立连接</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span> </span><br><span class="line"><span class="keyword">import</span> &#123; CSSTransition &#125; <span class="keyword">from</span> <span class="string">'react-transition-group'</span> <span class="comment">// CSS 动画库</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; actionCreators &#125; <span class="keyword">from</span> <span class="string">'./store'</span> <span class="comment">// 引入创建 action 对象方法库</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    HeaderWrapper,</span><br><span class="line">    Container,</span><br><span class="line">    Logo,</span><br><span class="line">    Nav,</span><br><span class="line">    NavItem,</span><br><span class="line">    SearchWrapper,</span><br><span class="line">    SearchInfo,</span><br><span class="line">    SearchInfoTitle,</span><br><span class="line">    SearchInfoSwitch,</span><br><span class="line">    SearchInfoList,</span><br><span class="line">    SearchInfoListItem,</span><br><span class="line">    NavSearch,</span><br><span class="line">    Addition,</span><br><span class="line">    Button</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'./style'</span> <span class="comment">// 样式组件库中引入 UI 组件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Header = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> ref = React.createRef();</span><br><span class="line">    <span class="keyword">const</span> &#123; </span><br><span class="line">        focused, </span><br><span class="line">        list, </span><br><span class="line">        page, </span><br><span class="line">        totalPage, </span><br><span class="line">        mouseIn, </span><br><span class="line">        searchFocus, </span><br><span class="line">        searchBlur, </span><br><span class="line">        enterSearchInfo, </span><br><span class="line">        leaveSearchInfo, </span><br><span class="line">        changeSearchInfoPage </span><br><span class="line">        &#125; = props;</span><br><span class="line">    <span class="keyword">const</span> jsList = list.toJS();</span><br><span class="line">    <span class="keyword">const</span>  pageList = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(jsList.length)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = (page<span class="number">-1</span>)*<span class="number">10</span>; i &lt; page*<span class="number">10</span>; i++) &#123;</span><br><span class="line">            pageList.push(</span><br><span class="line">                &lt;SearchInfoListItem key=&#123;jsList[i]&#125;&gt;&#123;jsList[i]&#125;&lt;<span class="regexp">/SearchInfoListItem&gt;</span></span><br><span class="line"><span class="regexp">            )</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">        &lt;HeaderWrapper&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Container&gt;</span></span><br><span class="line"><span class="regexp">                &lt;Logo href='/</span><span class="string">'/&gt;</span></span><br><span class="line"><span class="string">                &lt;Nav&gt;</span></span><br><span class="line"><span class="string">                    &lt;NavItem className='</span>left active<span class="string">'&gt;首页&lt;/NavItem&gt;</span></span><br><span class="line"><span class="string">                    &lt;NavItem className='</span>left<span class="string">'&gt;下载&lt;/NavItem&gt;</span></span><br><span class="line"><span class="string">                    &lt;NavItem className='</span>right<span class="string">'&gt;登录&lt;/NavItem&gt;</span></span><br><span class="line"><span class="string">                    &lt;NavItem className='</span>right<span class="string">'&gt;</span></span><br><span class="line"><span class="string">                        &lt;span className="iconfont"&gt;&amp;#xe636;&lt;/span&gt;</span></span><br><span class="line"><span class="string">                    &lt;/NavItem&gt;</span></span><br><span class="line"><span class="string">                    &lt;SearchWrapper&gt;</span></span><br><span class="line"><span class="string">                        &lt;CSSTransition</span></span><br><span class="line"><span class="string">                            timeout=&#123;200&#125;</span></span><br><span class="line"><span class="string">                            in=&#123;focused&#125;</span></span><br><span class="line"><span class="string">                            classNames='</span>slide<span class="string">'</span></span><br><span class="line"><span class="string">                        &gt;</span></span><br><span class="line"><span class="string">                            &lt;NavSearch</span></span><br><span class="line"><span class="string">                                className=&#123;focused ? '</span>focused<span class="string">' : '</span><span class="string">'&#125;</span></span><br><span class="line"><span class="string">                                onFocus=&#123;()=&gt;&#123;searchFocus(list)&#125;&#125;</span></span><br><span class="line"><span class="string">                                onBlur=&#123;searchBlur&#125;</span></span><br><span class="line"><span class="string">                            &gt;&lt;/NavSearch&gt;</span></span><br><span class="line"><span class="string">                        &lt;/CSSTransition&gt;</span></span><br><span class="line"><span class="string">                        &lt;span className=&#123;focused ? '</span>iconfont focused zoom<span class="string">' : '</span>iconfont zoom<span class="string">'&#125;&gt;&amp;#xe614;&lt;/span&gt;</span></span><br><span class="line"><span class="string">                        &lt;SearchInfo</span></span><br><span class="line"><span class="string">                            className=&#123;focused||mouseIn ? '</span><span class="string">' : '</span>noShow<span class="string">'&#125;</span></span><br><span class="line"><span class="string">                            onMouseEnter=&#123;enterSearchInfo&#125;</span></span><br><span class="line"><span class="string">                            onMouseLeave=&#123;leaveSearchInfo&#125;</span></span><br><span class="line"><span class="string">                        &gt;</span></span><br><span class="line"><span class="string">                            &lt;SearchInfoTitle&gt;</span></span><br><span class="line"><span class="string">                                热门搜索</span></span><br><span class="line"><span class="string">                                &lt;SearchInfoSwitch</span></span><br><span class="line"><span class="string">                                    onClick=&#123;()=&gt;&#123;changeSearchInfoPage(page, totalPage, ref.current)&#125;&#125;</span></span><br><span class="line"><span class="string">                                &gt;</span></span><br><span class="line"><span class="string">                                    &lt;span ref = &#123;ref&#125; className="iconfont spin"&gt;&amp;#xe6ac;&lt;/span&gt;</span></span><br><span class="line"><span class="string">                                    换一批</span></span><br><span class="line"><span class="string">                                &lt;/SearchInfoSwitch&gt;</span></span><br><span class="line"><span class="string">                            &lt;/SearchInfoTitle&gt;</span></span><br><span class="line"><span class="string">                            &lt;SearchInfoList&gt;</span></span><br><span class="line"><span class="string">                                &#123;pageList&#125;</span></span><br><span class="line"><span class="string">                            &lt;/SearchInfoList&gt;</span></span><br><span class="line"><span class="string">                        &lt;/SearchInfo&gt;</span></span><br><span class="line"><span class="string">                    &lt;/SearchWrapper&gt;</span></span><br><span class="line"><span class="string">                &lt;/Nav&gt;</span></span><br><span class="line"><span class="string">                &lt;Addition&gt;</span></span><br><span class="line"><span class="string">                    &lt;Button className='</span>writting<span class="string">'&gt;</span></span><br><span class="line"><span class="string">                        &lt;span className="iconfont"&gt;&amp;#xe60e;&lt;/span&gt;</span></span><br><span class="line"><span class="string">                        写文章</span></span><br><span class="line"><span class="string">                    &lt;/Button&gt;</span></span><br><span class="line"><span class="string">                    &lt;Button className='</span>reg<span class="string">'&gt;注册&lt;/Button&gt;</span></span><br><span class="line"><span class="string">                &lt;/Addition&gt;</span></span><br><span class="line"><span class="string">            &lt;/Container&gt;</span></span><br><span class="line"><span class="string">        &lt;/HeaderWrapper&gt;</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 使用 connect() 前，需要先定义 mapStateToProps，该方法将当前 store 中的 state 映射到展示组件的 props 中</span></span><br><span class="line"><span class="string">const mapStateToProps = (state) =&gt; &#123; </span></span><br><span class="line"><span class="string">    return &#123;</span></span><br><span class="line"><span class="string">        /* 获取 header 中的 reducer 中的 focused 值（src/common/header/index.js =&gt; src/store/reducer =&gt; src/common/header/store/reducer.js，</span></span><br><span class="line"><span class="string">        src/common/header/store/reducer.js 中将 state 变为 immutable 对象，所以用其语法 getIn 获取数据） */</span></span><br><span class="line"><span class="string">        focused: state.getIn(['</span>header<span class="string">', '</span>focused<span class="string">']),  </span></span><br><span class="line"><span class="string">        mouseIn: state.getIn(['</span>header<span class="string">', '</span>mouseIn<span class="string">']),</span></span><br><span class="line"><span class="string">        list: state.getIn(['</span>header<span class="string">', '</span>list<span class="string">']),</span></span><br><span class="line"><span class="string">        page: state.getIn(['</span>header<span class="string">', '</span>page<span class="string">']),</span></span><br><span class="line"><span class="string">        totalPage: state.getIn(['</span>header<span class="string">', '</span>totalPage<span class="string">'])</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">/* mapDispatchToProps 接收 dispatch() 方法并返回期望注入到展示组件 props 中的回调方法中，引入 actionCreators 中已创建好的 action 对象</span></span><br><span class="line"><span class="string">进行派发（派发至 src/common/header/store/reducer.js 中，根据 type 类型进行 state 操作） */</span></span><br><span class="line"><span class="string">const mapDispatchToProps = (dispatch) =&gt; &#123; </span></span><br><span class="line"><span class="string">    return &#123;</span></span><br><span class="line"><span class="string">        searchFocus(list) &#123;</span></span><br><span class="line"><span class="string">            list.size===0 &amp;&amp; dispatch(actionCreators.getList())</span></span><br><span class="line"><span class="string">            dispatch(actionCreators.searchFocuse())</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        searchBlur() &#123;</span></span><br><span class="line"><span class="string">            dispatch(actionCreators.searchBlur())</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        enterSearchInfo() &#123;</span></span><br><span class="line"><span class="string">            dispatch(actionCreators.enterSearchInfo())</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        leaveSearchInfo() &#123;</span></span><br><span class="line"><span class="string">            dispatch(actionCreators.leaveSearchInfo())</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        changeSearchInfoPage(page, totalPage, spin) &#123;</span></span><br><span class="line"><span class="string">            let originAngle = spin.style.transform.replace(/\D/g, '</span><span class="string">');</span></span><br><span class="line"><span class="string">            if(originAngle||originAngle===0)&#123;</span></span><br><span class="line"><span class="string">                originAngle = parseInt(originAngle)</span></span><br><span class="line"><span class="string">            &#125;else&#123;</span></span><br><span class="line"><span class="string">                originAngle = 0;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            spin.style.transform = `rotate($&#123;originAngle+360&#125;deg)`</span></span><br><span class="line"><span class="string">            if(page &lt; totalPage)&#123;</span></span><br><span class="line"><span class="string">                dispatch(actionCreators.changeSearchInfoPage(page+1))</span></span><br><span class="line"><span class="string">            &#125;else&#123;</span></span><br><span class="line"><span class="string">                dispatch(actionCreators.changeSearchInfoPage(1))</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default connect(mapStateToProps, mapDispatchToProps)(Header)</span></span><br></pre></td></tr></table></figure>


<h4 id="header-style-js"><a href="#header-style-js" class="headerlink" title="header/style.js"></a>header/style.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****** src/common/header/style.js ******/</span></span><br><span class="line"><span class="comment">// 带有样式的组件，重点是对 styled-components 中的用法做简单了解</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">'styled-components'</span></span><br><span class="line"><span class="keyword">import</span> logoPic <span class="keyword">from</span> <span class="string">'../../statics/images/logo.png'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> HeaderWrapper = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">    border: 1px solid #f0f0f0;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Container = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">    position: relative;</span></span><br><span class="line"><span class="string">    width: 1440px;</span></span><br><span class="line"><span class="string">    height: 56px;</span></span><br><span class="line"><span class="string">    margin: 0 auto;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Logo = styled.a<span class="string">`</span></span><br><span class="line"><span class="string">    position: absolute;</span></span><br><span class="line"><span class="string">    top: 0;</span></span><br><span class="line"><span class="string">    left: 0;</span></span><br><span class="line"><span class="string">    display: block;</span></span><br><span class="line"><span class="string">    width: 100px;</span></span><br><span class="line"><span class="string">    height: 56px;</span></span><br><span class="line"><span class="string">    background: url(<span class="subst">$&#123;logoPic&#125;</span>) no-repeat center/contain;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Nav = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">    width: 960px;</span></span><br><span class="line"><span class="string">    height: 100%;</span></span><br><span class="line"><span class="string">    padding-right: 70px;</span></span><br><span class="line"><span class="string">    box-sizing: border-box;</span></span><br><span class="line"><span class="string">    margin: 0 auto;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> NavItem = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">    line-height: 56px;</span></span><br><span class="line"><span class="string">    padding: 0 15px;</span></span><br><span class="line"><span class="string">    font-size:17px;</span></span><br><span class="line"><span class="string">    &amp;.left &#123;</span></span><br><span class="line"><span class="string">        float: left;</span></span><br><span class="line"><span class="string">        color: #333;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &amp;.right &#123;</span></span><br><span class="line"><span class="string">        float: right;</span></span><br><span class="line"><span class="string">        color: #969696;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &amp;.active &#123;</span></span><br><span class="line"><span class="string">        color: #ea6f5a;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SearchWrapper = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">    position: relative;</span></span><br><span class="line"><span class="string">    float: left;</span></span><br><span class="line"><span class="string">    .zoom &#123;</span></span><br><span class="line"><span class="string">        position: absolute;</span></span><br><span class="line"><span class="string">        right: 5px;</span></span><br><span class="line"><span class="string">        bottom: 4px;</span></span><br><span class="line"><span class="string">        display: block;</span></span><br><span class="line"><span class="string">        width: 30px;</span></span><br><span class="line"><span class="string">        line-height: 30px;</span></span><br><span class="line"><span class="string">        border-radius: 20px;</span></span><br><span class="line"><span class="string">        text-align: center;</span></span><br><span class="line"><span class="string">        &amp;.focused &#123;</span></span><br><span class="line"><span class="string">            background: #969696;</span></span><br><span class="line"><span class="string">            color: #fefefe;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> NavSearch = styled.input.attrs(&#123;</span><br><span class="line">    placeholder: <span class="string">'搜索'</span></span><br><span class="line">&#125;)<span class="string">`</span></span><br><span class="line"><span class="string">    width: 160px;</span></span><br><span class="line"><span class="string">    height: 38px;</span></span><br><span class="line"><span class="string">    padding: 0 30px 0 20px;</span></span><br><span class="line"><span class="string">    border: none;</span></span><br><span class="line"><span class="string">    border-radius: 19px;</span></span><br><span class="line"><span class="string">    margin-top: 9px;</span></span><br><span class="line"><span class="string">    margin-left: 20px;</span></span><br><span class="line"><span class="string">    box-sizing: border-box;</span></span><br><span class="line"><span class="string">    outline: none;</span></span><br><span class="line"><span class="string">    background: #eee;</span></span><br><span class="line"><span class="string">    font-size: 15px;</span></span><br><span class="line"><span class="string">    color: #666;</span></span><br><span class="line"><span class="string">    &amp;::placeholder &#123;</span></span><br><span class="line"><span class="string">        color: #999;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &amp;.focused &#123;</span></span><br><span class="line"><span class="string">        width: 240px;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &amp;.slide-enter &#123;</span></span><br><span class="line"><span class="string">        transition: all .2s ease-out;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &amp;.slider-enter-active &#123;</span></span><br><span class="line"><span class="string">        width: 240px;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &amp;.slide-exit &#123;</span></span><br><span class="line"><span class="string">        transition: all .2s ease-out</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &amp;.slide-exit-active &#123;</span></span><br><span class="line"><span class="string">        width: 160px;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SearchInfo = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">    position: absolute;</span></span><br><span class="line"><span class="string">    left: 0;</span></span><br><span class="line"><span class="string">    top: 56px;</span></span><br><span class="line"><span class="string">    width: 240px;</span></span><br><span class="line"><span class="string">    padding: 0 20px;</span></span><br><span class="line"><span class="string">    box-shadow: 0 0 8px rgba(0, 0, 0, .2);</span></span><br><span class="line"><span class="string">    &amp;.noShow&#123;</span></span><br><span class="line"><span class="string">        display: none;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SearchInfoTitle = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">    margin-top: 20px;</span></span><br><span class="line"><span class="string">    margin-bottom: 15px;</span></span><br><span class="line"><span class="string">    line-height: 20px;</span></span><br><span class="line"><span class="string">    color: #969696;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SearchInfoSwitch = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">    float: right;</span></span><br><span class="line"><span class="string">    font-size: 14px;</span></span><br><span class="line"><span class="string">    cursor: pointer;</span></span><br><span class="line"><span class="string">    user-select:none;</span></span><br><span class="line"><span class="string">    .spin&#123;</span></span><br><span class="line"><span class="string">        display: block;</span></span><br><span class="line"><span class="string">        float: left;</span></span><br><span class="line"><span class="string">        margin-right: 2px;</span></span><br><span class="line"><span class="string">        font-size: 12px;</span></span><br><span class="line"><span class="string">        transition: all .2s ease-in;</span></span><br><span class="line"><span class="string">        transform-origin: center;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SearchInfoList = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">    overflow: hidden;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SearchInfoListItem = styled.a<span class="string">`</span></span><br><span class="line"><span class="string">    display: block;</span></span><br><span class="line"><span class="string">    float: left;</span></span><br><span class="line"><span class="string">    line-height: 20px;</span></span><br><span class="line"><span class="string">    padding: 0 5px;</span></span><br><span class="line"><span class="string">    border: 1px solid #ddd;</span></span><br><span class="line"><span class="string">    border-radius: 3px;</span></span><br><span class="line"><span class="string">    margin-right: 10px;</span></span><br><span class="line"><span class="string">    margin-bottom: 15px;</span></span><br><span class="line"><span class="string">    font-size: 12px;</span></span><br><span class="line"><span class="string">    color: #787878;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Addition = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">    position: absolute;</span></span><br><span class="line"><span class="string">    top: 0;</span></span><br><span class="line"><span class="string">    right: 0;</span></span><br><span class="line"><span class="string">    height: 56px;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Button = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">    float: right;</span></span><br><span class="line"><span class="string">    padding: 0 20px;</span></span><br><span class="line"><span class="string">    margin-top: 9px;</span></span><br><span class="line"><span class="string">    margin-right: 20px;</span></span><br><span class="line"><span class="string">    line-height: 38px;</span></span><br><span class="line"><span class="string">    border-radius: 19px;</span></span><br><span class="line"><span class="string">    border: 1px solid #ec6149;</span></span><br><span class="line"><span class="string">    font-size: 14px;</span></span><br><span class="line"><span class="string">    &amp;.reg &#123;</span></span><br><span class="line"><span class="string">        color: #ec6149;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &amp;.writting &#123;</span></span><br><span class="line"><span class="string">        color: #fff;</span></span><br><span class="line"><span class="string">        background: #ec6149;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>


<h4 id="header-store-index-js"><a href="#header-store-index-js" class="headerlink" title="header/store/index.js"></a>header/store/index.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****** src/common/header/store/index.js ******/</span></span><br><span class="line"><span class="comment">// 对 header/store 中的文件做统一导出，方便其他文件引用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actionCreators <span class="keyword">from</span> <span class="string">'./actionCreators'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> constants <span class="keyword">from</span> <span class="string">'./constants'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; reducer, actionCreators, constants &#125;</span><br></pre></td></tr></table></figure>


<h4 id="header-store-constants-js"><a href="#header-store-constants-js" class="headerlink" title="header/store/constants.js"></a>header/store/constants.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****** src/common/header/store/constants.js ******/</span></span><br><span class="line"><span class="comment">// 也可以叫做 actionTypes.js，仅是将字符串变为常量，大型项目防止名称敲错但浏览器不报错，不能及时定位问题</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SEARCH_FOCUSE = <span class="string">'header/SEARCH_FOCUSE'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SEARCH_BLUR = <span class="string">'header/SEARCH_BLUR'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CHANGE_LIST = <span class="string">'header/CHANGE_LIST'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ENTER_SEARCH_INFO = <span class="string">'header/ENTER_SEARCH_INFO'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> LEAVE_SEARCH_INFO = <span class="string">'header/LEAVE_SEARCH_INFO'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CHANGE_SEARCH_INFO_PAGE = <span class="string">'header/CHANGE_SEARCH_INFO_PAGE'</span></span><br></pre></td></tr></table></figure>


<h4 id="header-store-actionCreators-js"><a href="#header-store-actionCreators-js" class="headerlink" title="header/store/actionCreators.js"></a>header/store/actionCreators.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****** src/common/header/store/actionCreators.js ******/</span></span><br><span class="line"><span class="comment">// 统一创建 action 对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; </span><br><span class="line">    SEARCH_FOCUSE, </span><br><span class="line">    SEARCH_BLUR, </span><br><span class="line">    CHANGE_LIST,</span><br><span class="line">    ENTER_SEARCH_INFO,</span><br><span class="line">    LEAVE_SEARCH_INFO,</span><br><span class="line">    CHANGE_SEARCH_INFO_PAGE</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'./constants'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 此处推荐做 axios，当然你得在 src/store/index.js 中做中间件设置，这样才可以将 action 对象变为函数导出</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span> </span><br><span class="line"><span class="comment">// 将纯 JS 对象和数组深层转换为不可变映射和列表（immutable 类型数据），immutable 类型数据仅能通过同类型数据进行更改</span></span><br><span class="line"><span class="keyword">import</span> &#123; fromJS &#125; <span class="keyword">from</span> <span class="string">'immutable'</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">// *************************************</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> changeList = <span class="function">(<span class="params">data</span>) =&gt;</span> (&#123;</span><br><span class="line">    type: CHANGE_LIST,</span><br><span class="line">    data: fromJS(data), <span class="comment">// 将替换 src/common/header/store/reducer.js 中 state（immutable 类型数据）中的 list 值</span></span><br><span class="line">    totalPage: <span class="built_in">Math</span>.ceil(data.length / <span class="number">10</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// **************************************</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> searchFocuse = <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    type: SEARCH_FOCUSE</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> searchBlur = <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    type: SEARCH_BLUR</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> enterSearchInfo = <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    type: ENTER_SEARCH_INFO</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> leaveSearchInfo = <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    type: LEAVE_SEARCH_INFO</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> changeSearchInfoPage = <span class="function">(<span class="params">page</span>) =&gt;</span> (&#123;</span><br><span class="line">    type: CHANGE_SEARCH_INFO_PAGE,</span><br><span class="line">    page</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getList = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">'/api/headerList.json'</span>)</span><br><span class="line">            .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">                dispatch(changeList(res.data.data))</span><br><span class="line">            &#125;)</span><br><span class="line">            .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(err)</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="header-store-reducer-js"><a href="#header-store-reducer-js" class="headerlink" title="header/store/reducer.js"></a>header/store/reducer.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****** src/common/header/store/reducer.js ******/</span></span><br><span class="line"><span class="comment">// 根据 src/common/header/store/actionCreators.js 中派发过来的 type 类型对 state 进行操作，并返回新的 state 供其它组件使用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; </span><br><span class="line">    SEARCH_FOCUSE, </span><br><span class="line">    SEARCH_BLUR,</span><br><span class="line">    CHANGE_LIST,</span><br><span class="line">    ENTER_SEARCH_INFO,</span><br><span class="line">    LEAVE_SEARCH_INFO,</span><br><span class="line">    CHANGE_SEARCH_INFO_PAGE</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'./constants'</span></span><br><span class="line"><span class="comment">// 将纯 JS 对象和数组深层转换为不可变映射和列表（immutable 类型数据），这样 state 将不会被改变</span></span><br><span class="line"><span class="keyword">import</span> &#123; fromJS &#125; <span class="keyword">from</span> <span class="string">'immutable'</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">// immutable 对象只能用 immutable 语法进行 state 中的属性值获取（getIn）和更改（set 和 merge 方法）</span></span><br><span class="line"><span class="keyword">const</span> defaultState = fromJS(&#123; </span><br><span class="line">    focused: <span class="literal">false</span>,</span><br><span class="line">    mouseIn: <span class="literal">false</span>,</span><br><span class="line">    list: [],</span><br><span class="line">    page: <span class="number">1</span>,</span><br><span class="line">    totalPage: <span class="number">1</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState, action) =&gt; &#123;</span><br><span class="line">    <span class="keyword">switch</span>(action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> SEARCH_FOCUSE:</span><br><span class="line">            <span class="comment">// 对 state 的单个属性进行更改（set 为 immutable 的语法）</span></span><br><span class="line">            <span class="keyword">return</span> state.set(<span class="string">'focused'</span>, <span class="literal">true</span>) </span><br><span class="line">        <span class="keyword">case</span> SEARCH_BLUR:</span><br><span class="line">            <span class="keyword">return</span> state.set(<span class="string">'focused'</span>, <span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">case</span> CHANGE_LIST:</span><br><span class="line">            <span class="comment">// 对 state 的多个属性进行更改（merge 为 immutable 的语法）</span></span><br><span class="line">            <span class="keyword">return</span> state.merge(&#123;</span><br><span class="line">                list: action.data,</span><br><span class="line">                totalPage: action.totalPage</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="keyword">case</span> ENTER_SEARCH_INFO:</span><br><span class="line">            <span class="keyword">return</span> state.set(<span class="string">'mouseIn'</span>, <span class="literal">true</span>)</span><br><span class="line">        <span class="keyword">case</span> LEAVE_SEARCH_INFO:</span><br><span class="line">            <span class="keyword">return</span> state.set(<span class="string">'mouseIn'</span>, <span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">case</span> CHANGE_SEARCH_INFO_PAGE:</span><br><span class="line">            <span class="keyword">return</span> state.set(<span class="string">'page'</span>, action.page)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div><div class="post-copyright"><blockquote><p>原文作者: ShanYi Hui</p><p>原文链接: <a href="http://huishanyi.club/2019/11/04/React/Redux与react-redux/">http://huishanyi.club/2019/11/04/React/Redux与react-redux/</a></p><p>版权声明: 转载请注明出处(必须保留作者署名及链接)</p></blockquote></div><div class="tags"><a href="/tags/React/">React</a></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/2019/11/18/React/React生命周期/" class="pre">React生命周期</a><a href="/2019/09/23/React/React虚拟DOM/" class="next">React虚拟DOM</a></div><div id="comments"><div id="SOHUCS" sid="2019/11/04/React/Redux与react-redux/"></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Redux"><span class="toc-text">Redux</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建状态管理文件"><span class="toc-text">创建状态管理文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#js-文件源码及说明（toDoList-为例）"><span class="toc-text">js 文件源码及说明（toDoList 为例）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#toDoList-实例下载"><span class="toc-text">toDoList 实例下载</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#react-redux"><span class="toc-text">react-redux</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装-1"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建状态管理文件-1"><span class="toc-text">创建状态管理文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#js-文件示例及说明"><span class="toc-text">js 文件示例及说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#src-index-js"><span class="toc-text">src/index.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#src-App-js"><span class="toc-text">src/App.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#src-store-index"><span class="toc-text">src/store/index</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#src-store-reducer-js"><span class="toc-text">src/store/reducer.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#header-index-js"><span class="toc-text">header/index.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#header-style-js"><span class="toc-text">header/style.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#header-store-index-js"><span class="toc-text">header/store/index.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#header-store-constants-js"><span class="toc-text">header/store/constants.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#header-store-actionCreators-js"><span class="toc-text">header/store/actionCreators.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#header-store-reducer-js"><span class="toc-text">header/store/reducer.js</span></a></li></ol></li></ol></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/07/15/Web安全/CSRF攻击/">CSRF攻击</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/15/Web安全/XSS攻击/">XSS攻击</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/14/Web性能优化/强缓存和协商缓存/">强缓存和协商缓存</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/13/JS/JS操作字符串/">JS操作字符串</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/13/JS/JS操作数组/">JS操作数组</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/08/JS/Promise/">Promise</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/29/前端面试题/NodeJS面试题/">NodeJS面试题</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/29/前端面试题/Vue面试题/">Vue面试题</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/29/前端面试题/React面试题/">React面试题</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/29/前端面试题/CSS面试题/">CSS面试题</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Web安全/">Web安全</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web性能优化/">Web性能优化</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/后端/">后端</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/系统分析师/">系统分析师</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/项目实例/">项目实例</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/Web安全/" style="font-size: 15px;">Web安全</a> <a href="/tags/JS/" style="font-size: 15px;">JS</a> <a href="/tags/NodeJS/" style="font-size: 15px;">NodeJS</a> <a href="/tags/ES6/" style="font-size: 15px;">ES6</a> <a href="/tags/代码规范/" style="font-size: 15px;">代码规范</a> <a href="/tags/React/" style="font-size: 15px;">React</a> <a href="/tags/Web性能优化/" style="font-size: 15px;">Web性能优化</a> <a href="/tags/前端面试题/" style="font-size: 15px;">前端面试题</a> <a href="/tags/编辑器/" style="font-size: 15px;">编辑器</a> <a href="/tags/接口/" style="font-size: 15px;">接口</a> <a href="/tags/系统分析师/" style="font-size: 15px;">系统分析师</a> <a href="/tags/数据库/" style="font-size: 15px;">数据库</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/前言/" style="font-size: 15px;">前言</a> <a href="/tags/随笔/" style="font-size: 15px;">随笔</a> <a href="/tags/服务端搭建/" style="font-size: 15px;">服务端搭建</a> <a href="/tags/博客搭建/" style="font-size: 15px;">博客搭建</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="http://xian.yunshipei.com/" title="云适配" target="_blank">云适配</a><ul></ul><a href="https://www.deepcloudsec.com/" title="云深互联" target="_blank">云深互联</a><ul></ul><a href="https://github.com/ShanYi-Hui" title="惠善一的GitHub" target="_blank">惠善一的GitHub</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">ShanYi Hui.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script type="text/javascript">// 向百度推送页面 URL
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
  bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();</script><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.3"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.3" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script><script>window._config = { showScore: true };
(function(){ 
  var appid = 'cyuk0VGGw'; 
  var conf = '0bbf833c3126f88b729e02d5b6b060d2'; 
  var width = window.innerWidth || document.documentElement.clientWidth; 
  var nodes =document.getElementsByTagName("head")[0]||document.head||document.documentElement;
  if (/(Android|iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent) && width < 750) {  
      window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>');
  }
  else { 
    var loadJs=function(d,a){
      var b=document.createElement("script");b.setAttribute("type","text/javascript");
      b.setAttribute("charset","UTF-8");
      b.setAttribute("src",d);
      if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}
      nodes.appendChild(b)
    };
    loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); 
  } 
  var loadCss = function(cssString){  
    var style=document.createElement("style");  
    style.setAttribute("type", "text/css");  
    if(style.styleSheet){// IE  
        style.styleSheet.cssText = cssString;  
    } else {// w3c  
        var cssText = document.createTextNode(cssString);  
        style.appendChild(cssText);  
    }
    nodes.appendChild(style);
  }
  //- window.onload=function(){
  //-   if(window.outerWidth<=775){
  //-     loadCss('.module-hot-topic,.module-cmt-float-bar{display:none!important}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .wrap-action-w .cbox-prompt-w span.prompt-empty-w,#SOHUCS #SOHU_MAIN .module-cmt-float-bar .wrap-cont-w .cont-form-w .form-text-w span.text-null,#SOHUCS #SOHU_MAIN .module-cmt-float-bar .wrap-cont-w .cont-minwidth-w div.cont-comment-w a.comment-link-w,#SOHUCS #SOHU_MAIN .module-cmt-float-bar .wrap-cont-w .cont-minwidth-w div.cont-comment-w span.comment-text-w,#SOHUCS #SOHU_MAIN .module-cmt-footer .section-service-w div.service-wrap-w a:hover,#SOHUCS #SOHU_MAIN .module-cmt-header .section-cbox-w .block-head-w div.header-login,#SOHUCS #SOHU_MAIN .module-cmt-header .section-title-w .title-user-w .user-wrap-w span.wrap-name-w,#SOHUCS #SOHU_MAIN .module-cmt-list .action-click-gw span.click-disable-eg a em.icon-name-bg,#SOHUCS #SOHU_MAIN .module-cmt-list .block-title-gw ul li div.title-name-gw,#SOHUCS #SOHU_MAIN .module-cmt-list .cmt-list-type .cmt-list-number .comment-number span.cy-number,#SOHUCS #SOHU_MAIN .module-cmt-list .cmt-list-type .cmt-list-number span.comment-number,#SOHUCS #SOHU_MAIN .module-cmt-list .cmt-list-type .type-lists li.active,#SOHUCS #SOHU_MAIN .module-cmt-list .msg-wrap-gw .wrap-action-gw .action-click-gw span a:hover,#SOHUCS #SOHU_MAIN .module-cmt-list .picture-box-gw div.box-action-gw a:hover,#SOHUCS #SOHU_MAIN .module-cmt-list .wrap-action-gw .action-click-gw span a:hover em.icon-name-bg,#SOHUCS #SOHU_MAIN .module-cmt-list .wrap-user-gw span.user-name-gw a{color:#40759b!important}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .post-wrap-border-t div.post-wrap-border-t-r,#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w div.post-wrap-border-l,#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w div.post-wrap-border-r{display:none!important}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .post-wrap-border-t div.post-wrap-border-t-l{background:#FFF!important;top:-2px!important}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .wrap-action-w .action-function-w .uploading-wrapper-dw div.wrapper-image-dw,#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w div.post-wrap-main,#SOHUCS #SOHU_MAIN .module-cmt-float-bar .wrap-cont-w .cont-form-w div.form-text-w,#SOHUCS #SOHU_MAIN .module-cmt-header .section-cbox-w .block-head-w div.header-login,#SOHUCS #SOHU_MAIN .module-cmt-list .module-cmt-box .post-wrap-w div.post-wrap-main{border:1px solid #e6e6e6!important;border-radius:20px 20px 20px 20px;margin:0!important}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .wrap-action-w .action-issue-w .issue-btn-w a .btn-fw{width:130px!important;height:34px!important;line-height:33px!important;font-size:17px!important;background:#5483b1!important;border-radius:20px!important;color:#FFF!important;-webkit-box-shadow:0 -1px 4px #5483b1 inset;box-shadow:0 -1px 10px #5483b1 inset}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .wrap-action-w .action-issue-w .issue-btn-w a .btn-fw:before{content:"发表评论"}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .wrap-action-w .action-issue-w .issue-btn-w a:hover .btn-fw{color:#40759b!important;background:#FFF!important}#SOHUCS #SOHU_MAIN .module-cmt-list .cmt-list-type .type-lists li{background:none!important;border-bottom:1px solid #e6e6e6}#SOHUCS #SOHU_MAIN .module-cmt-list .cmt-list-type .type-lists li.active{border:1px solid #e6e6e6;border-radius:10px 10px 0 0;border-bottom:none}#SOHUCS #SOHU_MAIN .module-cmt-list .block-title-gw ul li .title-name-gw div.title-name-gw-tag{background:#5483b1!important;border-radius:3px}#SOHUCS #SOHU_MAIN .module-cmt-list .cmt-list-type div.cmt-list-border{background-color:#e6e6e6!important}#SOHUCS #SOHU_MAIN .module-cmt-notice ul.nt-list li.nt-item{border:1px solid #e6e6e6!important}#SOHUCS #SOHU_MAIN .module-cmt-notice ul.nt-list li.nt-item .nt-logo{text-align:center;line-height:40px;border-radius:50%!important;background:#e6e6e6!important}#SOHUCS #SOHU_MAIN .module-cmt-notice ul.nt-list li.nt-item .nt-logo:before{content:"畅";font-size:22px;color:#FFF}#SOHUCS #SOHU_MAIN .module-cmt-notice ul.nt-list li.nt-item a.nt-text,#SOHUCS #SOHU_MAIN .module-cmt-notice ul.nt-list li.nt-item a.nt-text i{color:#5483b1!important}#SOHUCS #SOHU_MAIN .module-cmt-header .section-title-w .title-user-w .user-wrap-w{background:#FFF!important}@media screen and (min-width:900px){#SOHUCS #SOHU_MAIN .module-mobile-cmt-list .list-wrapper-wap .list-container-wap .list-item-wap .list-content-wrapper-wap .cmt-list-image-container .cmt-list-image{max-width: 100%;}}');
  //-   }
  //- };
})();
function removeElement(_element){
     var _parentElement = _element.parentNode;
     if(_parentElement){
            _parentElement.removeChild(_element);
     }
}
var removeAD = document.createElement("div");
removeAD.id = 'removeAD';
var adInterval1 = setInterval(function() {
  if(document.querySelector("#feedAv")){
    document.querySelector("[node-type=cmt-list]").appendChild(removeAD);
    document.querySelector("#removeAD").appendChild(document.querySelector("#feedAv"));
    //- removeElement(document.querySelectorAll("#feedAv")[0]);
    var feedAv = document.querySelector("#feedAv").children;
    for( item of feedAv){
      item.style.display = 'none'
    }
    document.querySelector("#removeAD").style.display="none"
    clearInterval(adInterval1);
  }
},1000);
var adInterval2 = setInterval(function() {
  if(document.querySelector("#pop_ad")){
    removeElement(document.querySelector("#pop_ad"));
    clearInterval(adInterval2);
  }
}, 1000);</script><script src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script><script type="text/javascript">//- 去畅言评论
let $comments = document.getElementById('comments')
if($comments)
  setTimeout('deleteAD()',2000)
  function deleteAD(){
    let ads = document.querySelectorAll('#feedAv')
    if(ads.length>5){
      for(var i=0; i<ads.length; i++){
        ads[i].removeAttribute('style')
        if(i==(ads.length-1) && !ads[i].style.height) console.log('postsAD has been cleaned!')
      }
    }else{
      setTimeout('deleteAD()',2000)
    }
  }</script></body></html>